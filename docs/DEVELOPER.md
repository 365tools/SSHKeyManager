# ğŸ‘©â€ğŸ’» å¼€å‘è€…æ–‡æ¡£

> SSH Key Manager å¼€å‘æŒ‡å—ä¸æ¶æ„æ–‡æ¡£

æœ¬æ–‡æ¡£æ—¨åœ¨å¸®åŠ©å¼€å‘è€…ç†è§£ SSH Key Manager çš„æ¶æ„è®¾è®¡ï¼Œæ­å»ºå¼€å‘ç¯å¢ƒï¼Œå¹¶å‚ä¸åˆ°é¡¹ç›®ä¸­æ¥ã€‚

## ğŸ“‹ ç›®å½•

- [é¡¹ç›®æ¶æ„](#-é¡¹ç›®æ¶æ„)
- [æ ¸å¿ƒæ¨¡å—è¯¦è§£](#-æ ¸å¿ƒæ¨¡å—è¯¦è§£)
- [å¼€å‘ç¯å¢ƒæ­å»º](#-å¼€å‘ç¯å¢ƒæ­å»º)
- [ä»£ç è§„èŒƒ](#-ä»£ç è§„èŒƒ)
- [æ„å»ºä¸å‘å¸ƒ](#-æ„å»ºä¸å‘å¸ƒ)
- [è´¡çŒ®æŒ‡å—](#-è´¡çŒ®æŒ‡å—)

---

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

æœ¬é¡¹ç›®é‡‡ç”¨æ¸…æ™°çš„æ¨¡å—åŒ–åˆ†å±‚æ¶æ„ï¼Œéµå¾ª **å•ä¸€èŒè´£åŸåˆ™ (SRP)** å’Œ **ç»„åˆä¼˜äºç»§æ‰¿** çš„è®¾è®¡ç†å¿µã€‚

### ç›®å½•ç»“æ„

```text
src/sshm/
â”œâ”€â”€ __init__.py         # åŒ…å¯¼å‡ºå®šä¹‰
â”œâ”€â”€ __main__.py         # CLI å…¥å£ (python -m sshm)
â”œâ”€â”€ constants.py        # å…¨å±€å¸¸é‡ (ç‰ˆæœ¬å·, è·¯å¾„ç­‰)
â”‚
â”œâ”€â”€ core/               # ğŸ§  æ ¸å¿ƒä¸šåŠ¡å±‚
â”‚   â”œâ”€â”€ config.py       # SSHConfigManager: ~/.ssh/config æ–‡ä»¶ç®¡ç†
â”‚   â”œâ”€â”€ manager.py      # SSHKeyManager: ä¸šåŠ¡é€»è¾‘æ€»æ§ (Facade)
â”‚   â””â”€â”€ state.py        # StateManager: çŠ¶æ€æŒä¹…åŒ– (.sshm_state)
â”‚
â”œâ”€â”€ utils/              # ğŸ”§ å·¥å…·å±‚
â”‚   â”œâ”€â”€ console.py      # ç»ˆç«¯è¾“å‡ºã€ç¼–ç ä¿®å¤ã€äº¤äº’æç¤º
â”‚   â”œâ”€â”€ system.py       # ç³»ç»Ÿçº§æ“ä½œ (Environment, Registry, Shell)
â”‚   â””â”€â”€ updater.py      # è‡ªåŠ¨æ›´æ–°é€»è¾‘
â”‚
â””â”€â”€ cli/                # ğŸ–¥ï¸ äº¤äº’å±‚
    â”œâ”€â”€ parser.py       # ArgumentParser å‚æ•°å®šä¹‰
    â”œâ”€â”€ commands.py     # å‘½ä»¤è·¯ç”±ä¸åˆ†å‘
    â””â”€â”€ interactive.py  # TUI (æ–‡æœ¬ç”¨æˆ·ç•Œé¢) å®ç°
```

### è®¾è®¡æ¨¡å¼

1.  **å¤–è§‚æ¨¡å¼ (Facade)**: `SSHKeyManager` ç±»ä½œä¸ºç³»ç»Ÿçš„ç»Ÿä¸€å…¥å£ï¼Œå°è£…äº† `SSHConfigManager` å’Œ `StateManager` çš„å¤æ‚æ“ä½œã€‚
2.  **ç»„åˆæ¨¡å¼**: `SSHKeyManager` å†…éƒ¨ç»„åˆäº† `config_manager` å’Œ `state_manager` å®ä¾‹ï¼Œè€Œéé€šè¿‡ç»§æ‰¿æ‰©å±•åŠŸèƒ½ã€‚
3.  **ä¾èµ–æ³¨å…¥**: ä¸»è¦ç±»å‡æ”¯æŒåœ¨æ„é€ å‡½æ•°ä¸­æ³¨å…¥ `ssh_dir` ç­‰ä¾èµ–ï¼Œä¾¿äºå•å…ƒæµ‹è¯•ã€‚

---

## ğŸ” æ ¸å¿ƒæ¨¡å—è¯¦è§£

### 1. æ ¸å¿ƒä¸šåŠ¡å±‚ (`core/`)

#### `manager.py` - ä¸šåŠ¡æ€»æ§
- **èŒè´£**: åè°ƒå¯†é’¥æ–‡ä»¶çš„æ“ä½œã€Config çš„æ›´æ–°å’ŒçŠ¶æ€çš„ä¿å­˜ã€‚
- **å…³é”®æ–¹æ³•**:
    - `add_key()`: ç”Ÿæˆå¯†é’¥ -> æ›´æ–° Config -> å¤‡ä»½ -> æ›´æ–°çŠ¶æ€
    - `switch_key()`: æ›´æ”¹ç¬¦å·é“¾æ¥/æ–‡ä»¶å†…å®¹ -> æ›´æ–°çŠ¶æ€
    - `use_key_for_repo()`: è¯†åˆ« Git ä»“åº“ -> ä¿®æ”¹ `.git/config`

#### `config.py` - SSH é…ç½®ç®¡ç†
- **èŒè´£**:ä¸ä»…æ˜¯è¯»å†™æ–‡æœ¬ï¼Œè€Œæ˜¯ä»¥ç»“æ„åŒ–çš„æ–¹å¼ï¼ˆHost Blockï¼‰ç®¡ç† SSH Configã€‚
- **ç‰¹æ€§**: è‡ªåŠ¨è¯†åˆ«å¹¶ä¿ç•™ç”¨æˆ·æ‰‹åŠ¨æ·»åŠ çš„é SSHM ç®¡ç†çš„é…ç½®å—ã€‚

#### `state.py` - çŠ¶æ€æŒä¹…åŒ–
- **èŒè´£**: ç»´æŠ¤ `.sshm_state` JSON æ–‡ä»¶ï¼Œè®°å½•å½“å‰æ´»è·ƒçš„å¯†é’¥ã€æ ‡ç­¾æ˜ å°„å…³ç³»ã€‚

### 2. å·¥å…·å±‚ (`utils/`)

#### `system.py` - è·¨å¹³å°é€‚é…
- **éš¾ç‚¹**: å¤„ç† Windows (Registry) ä¸ Unix (Shell config) æˆªç„¶ä¸åŒçš„ç¯å¢ƒå˜é‡è®¾ç½®æ–¹å¼ã€‚
- **å®ç°**: å°è£…äº† `set_path` ç­‰åŸå­æ“ä½œï¼Œå¯¹ä¸Šå±‚å±è”½å¹³å°å·®å¼‚ã€‚

#### `console.py` - ç”¨æˆ·ä½“éªŒ
- **èŒè´£**: ç»Ÿä¸€çš„è¾“å‡ºæ ¼å¼ï¼ˆEmoji, é¢œè‰²ï¼‰ï¼Œä»¥åŠ Windows ä¸‹ cmd/powershell çš„ UTF-8 ç¼–ç è‡ªåŠ¨ä¿®å¤ï¼ˆè¿™æ˜¯ Python åœ¨ Windows ä¸‹çš„å¸¸è§ç—›ç‚¹ï¼‰ã€‚

---

## ğŸ’» å¼€å‘ç¯å¢ƒæ­å»º

### å‰ç½®è¦æ±‚
- Python 3.6+
- Git

### æ­¥éª¤

1.  **å…‹éš†ä»“åº“**
    ```bash
    git clone https://github.com/365tools/SSHKeyManager.git
    cd SSHManager
    ```

2.  **ä»¥å¼€å‘æ¨¡å¼è¿è¡Œ**
    å¯ä»¥ç›´æ¥ä½¿ç”¨ `python -m` æ–¹å¼è¿è¡Œï¼Œæ— éœ€æ„å»ºï¼š
    ```bash
    python -m sshm list
    python -m sshm --help
    ```

3.  **è¿è¡Œæµ‹è¯•** (æ¨è)
    ```bash
    python -m sshm test --all
    ```

---

## ğŸ“ ä»£ç è§„èŒƒ

- **é£æ ¼**: éµå¾ª PEP 8ã€‚
- **ç±»å‹æç¤º**: æ‰€æœ‰å‡½æ•°ç­¾åå¿…é¡»åŒ…å« Type Hints (`typing` æ¨¡å—)ã€‚
- **æ–‡æ¡£å­—ç¬¦ä¸²**: å…¬å…±æ–¹æ³•éœ€åŒ…å« Docstrings (Google Style)ã€‚
- **å¯¼å…¥**: æ¨èä½¿ç”¨ç»å¯¹å¯¼å…¥ã€‚

ç¤ºä¾‹ï¼š
```python
def format_timestamp(dt: datetime) -> str:
    """æ ¼å¼åŒ–æ—¶é—´æˆ³ä¸ºæ ‡å‡†æ˜¾ç¤ºæ ¼å¼ã€‚

    Args:
        dt: datetime å¯¹è±¡

    Returns:
        str: æ ¼å¼åŒ–åçš„å­—ç¬¦ä¸² (YYYY-MM-DD HH:MM:SS)
    """
    return dt.strftime('%Y-%m-%d %H:%M:%S')
```

---

## ğŸ”¨ æ„å»ºä¸å‘å¸ƒ

æœ¬é¡¹ç›®ä½¿ç”¨ `PyInstaller` æ‰“åŒ…ä¸ºå•æ–‡ä»¶å¯æ‰§è¡Œç¨‹åºã€‚

### æœ¬åœ°æ„å»º

```bash
# å®‰è£…æ„å»ºä¾èµ–
pip install pyinstaller

# è¿è¡Œæ„å»ºè„šæœ¬
python scripts/build_local.py
```

æ„å»ºäº§ç‰©å°†è¾“å‡ºè‡³ `dist/` ç›®å½•ï¼š
- Windows: `dist/sshm.exe`
- Linux/macOS: `dist/sshm`

### CI/CD

GitHub Actions é…ç½®æ–‡ä»¶ä½äº `.github/workflows/`ï¼Œå½“æ¨é€ Tag æ—¶è‡ªåŠ¨è§¦å‘æ„å»ºå¹¶å‘å¸ƒ Releaseã€‚

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

1.  Fork æœ¬ä»“åº“ã€‚
2.  åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/CoolFeature`)ã€‚
3.  æäº¤æ›´æ”¹ (`git commit -m 'feat: Add CoolFeature'`)ã€‚
4.  æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/CoolFeature`)ã€‚
5.  æäº¤ Pull Requestã€‚

### æäº¤ä¿¡æ¯è§„èŒƒ (Conventional Commits)

- `feat`: æ–°åŠŸèƒ½
- `fix`: ä¿®å¤ Bug
- `docs`: æ–‡æ¡£å˜æ›´
- `style`: ä»£ç æ ¼å¼ (ä¸å½±å“é€»è¾‘)
- `refactor`: é‡æ„ (æ—¢æ— æ–°åŠŸèƒ½ä¹Ÿæ—  Bug ä¿®å¤)
- `chore`: æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨

---

## ğŸ”— å‚è€ƒèµ„æ–™

- [ç”¨æˆ·æ‰‹å†Œ](../README.md)
- [å¸¸è§é—®é¢˜](FAQ.md)
